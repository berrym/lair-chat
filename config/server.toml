# Lair Chat Server Configuration
#
# This is the main configuration file for the Lair Chat server.
# All settings have sensible defaults, but you can customize them as needed.
#
# For production deployments, review the security settings carefully
# and consider using environment variables for sensitive values.

# =============================================================================
# Server Network Configuration
# =============================================================================
[server]
# Server bind address - use "0.0.0.0" to bind to all interfaces
host = "127.0.0.1"

# Server port
port = 8080

# Maximum number of concurrent connections
max_connections = 1000

# Connection timeout in seconds
connection_timeout = 30

# Keep-alive timeout in seconds
keep_alive_timeout = 60

# Enable TLS/SSL encryption
enable_tls = false

# Path to TLS certificate file (required if enable_tls = true)
# tls_cert_path = "/path/to/cert.pem"

# Path to TLS private key file (required if enable_tls = true)
# tls_key_path = "/path/to/key.pem"

# Supported TLS versions
tls_versions = ["1.2", "1.3"]

# =============================================================================
# Database Configuration
# =============================================================================
[database]
# Database type: "sqlite", "postgresql", or "mysql"
database_type = "sqlite"

# Database connection URL or file path
# SQLite: "data/lair-chat.db" or ":memory:" for in-memory
# PostgreSQL: "postgresql://user:pass@localhost/dbname"
# MySQL: "mysql://user:pass@localhost/dbname"
url = "data/lair-chat.db"

# Maximum number of database connections in pool
max_connections = 10

# Minimum number of database connections in pool
min_connections = 1

# Database connection timeout in seconds
connection_timeout = 30

# Idle connection timeout in seconds (10 minutes)
idle_timeout = 600

# Automatically run database migrations on startup
auto_migrate = true

# Database-specific settings (key-value pairs)
# settings = {}

# =============================================================================
# Security Configuration
# =============================================================================
[security]
# Enable end-to-end encryption for messages
enable_encryption = true

# Session timeout in seconds (24 hours)
session_timeout = 86400

# Maximum login attempts before account lockout
max_login_attempts = 5

# Account lockout duration in seconds (15 minutes)
lockout_duration = 900

# Minimum password length
password_min_length = 8

# Require special characters in passwords
password_require_special = true

# Require numbers in passwords
password_require_numbers = true

# Require uppercase letters in passwords
password_require_uppercase = true

# Enable two-factor authentication (requires additional setup)
enable_2fa = false

# JWT secret for session tokens (generate a secure random string)
# If not provided, sessions won't persist across server restarts
# jwt_secret = "your-secret-key-here-make-it-long-and-random"

# Argon2 password hashing configuration
[security.argon2]
# Memory cost in KiB (64 MiB)
memory_cost = 65536

# Time cost (iterations)
time_cost = 3

# Parallelism factor
parallelism = 4

# Hash output length in bytes
hash_length = 32

# =============================================================================
# Logging Configuration
# =============================================================================
[logging]
# Log level: "trace", "debug", "info", "warn", "error", "off"
level = "info"

# Log format: "json", "pretty", "compact"
format = "pretty"

# Enable logging to file
enable_file_logging = true

# Log file path (directory will be created if it doesn't exist)
file_path = "logs/server.log"

# Maximum log file size in MB before rotation
max_file_size = 10

# Number of rotated log files to keep
max_files = 5

# Compress rotated log files
compress_logs = true

# Enable logging to stdout/stderr
enable_stdout = true

# Use JSON format for structured logging
enable_json = false

# Additional logging targets (key = module, value = level)
# targets = { "lair_chat::server" = "debug" }

# =============================================================================
# Feature Configuration
# =============================================================================
[features]
# Enable direct messaging between users
enable_direct_messages = true

# Allow users to create their own rooms
enable_user_room_creation = true

# Enable file uploads (disabled by default for security)
enable_file_uploads = false

# Maximum file upload size in MB
max_file_size = 10

# Allowed file extensions for uploads
allowed_file_types = ["txt", "md", "pdf", "png", "jpg", "jpeg", "gif"]

# Enable persistent message history
enable_message_history = true

# Message history retention in days (0 = unlimited)
message_history_retention = 0

# Enable full-text message search
enable_message_search = true

# Enable user profiles and avatars
enable_user_profiles = true

# Enable online/offline presence indicators
enable_presence = true

# Enable typing indicators
enable_typing_indicators = true

# Enable message reactions (emoji)
enable_reactions = true

# Enable message threading/replies (experimental)
enable_threading = false

# =============================================================================
# Rate Limiting and Resource Limits
# =============================================================================
[limits]
# Maximum messages per minute per user
messages_per_minute = 60

# Maximum message length in characters
max_message_length = 4000

# Maximum username length
max_username_length = 32

# Maximum room name length
max_room_name_length = 50

# Maximum number of rooms a user can create
max_rooms_per_user = 50

# Maximum users per room
max_users_per_room = 100

# Maximum concurrent connections per IP address
max_connections_per_ip = 10

# Rate limiting window in seconds
rate_limit_window = 60

# Memory limit in MB (for monitoring)
memory_limit = 512

# CPU usage limit percentage (for monitoring)
cpu_limit = 80.0

# =============================================================================
# Administrative Interface
# =============================================================================
[admin]
# Enable admin API for server management
enable_admin_api = true

# Admin API bind address
admin_host = "127.0.0.1"

# Admin API port
admin_port = 8081

# Admin authentication token (generate a secure random string)
# If not provided, admin API will be unsecured (NOT RECOMMENDED)
# admin_token = "your-admin-token-here"

# Enable Prometheus metrics endpoint
enable_metrics = true

# Metrics endpoint path
metrics_path = "/metrics"

# Enable health check endpoint
enable_health_check = true

# Health check endpoint path
health_check_path = "/health"

# Enable debug endpoints (disable in production)
enable_debug_endpoints = false

# Audit logging configuration
[admin.audit_log]
# Enable audit logging for admin actions
enabled = true

# Audit log file path
file_path = "logs/audit.log"

# Audit log format: "json" or "csv"
format = "json"

# Log administrative actions
log_admin_actions = true

# Log authentication events
log_auth_events = true

# Log security-related events
log_security_events = true

# Log data access events (may impact performance)
log_data_access = false

# =============================================================================
# Environment-Specific Overrides
# =============================================================================
#
# You can override any setting using environment variables with the format:
# LAIR_CHAT_SECTION_FIELD
#
# Examples:
# LAIR_CHAT_SERVER_PORT=9000
# LAIR_CHAT_DATABASE_URL="postgresql://localhost/prod_db"
# LAIR_CHAT_SECURITY_SESSION_TIMEOUT=3600
# LAIR_CHAT_LOGGING_LEVEL="debug"
#
# Boolean values can be: true/false, 1/0, yes/no, on/off, enabled/disabled
