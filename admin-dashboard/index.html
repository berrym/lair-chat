<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Lair Chat - Admin Dashboard</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    Oxygen, Ubuntu, Cantarell, sans-serif;
                background: #f5f7fa;
                color: #2c3e50;
                line-height: 1.6;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
            }

            .header {
                background: #34495e;
                color: white;
                padding: 1rem 2rem;
                margin-bottom: 2rem;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            .header h1 {
                font-size: 1.8rem;
                margin-bottom: 0.5rem;
            }

            .auth-section,
            .dashboard-section {
                background: white;
                padding: 2rem;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                margin-bottom: 2rem;
            }

            .hidden {
                display: none;
            }

            .form-group {
                margin-bottom: 1rem;
            }

            label {
                display: block;
                margin-bottom: 0.5rem;
                font-weight: 600;
                color: #555;
            }

            input,
            select,
            textarea {
                width: 100%;
                padding: 0.75rem;
                border: 2px solid #e1e8ed;
                border-radius: 4px;
                font-size: 1rem;
                transition: border-color 0.3s;
            }

            input:focus,
            select:focus,
            textarea:focus {
                outline: none;
                border-color: #3498db;
            }

            button {
                background: #3498db;
                color: white;
                padding: 0.75rem 1.5rem;
                border: none;
                border-radius: 4px;
                font-size: 1rem;
                cursor: pointer;
                transition: background-color 0.3s;
                margin-right: 0.5rem;
                margin-bottom: 0.5rem;
            }

            button:hover {
                background: #2980b9;
            }

            button.secondary {
                background: #95a5a6;
            }

            button.secondary:hover {
                background: #7f8c8d;
            }

            button.danger {
                background: #e74c3c;
            }

            button.danger:hover {
                background: #c0392b;
            }

            .tabs {
                display: flex;
                margin-bottom: 2rem;
                border-bottom: 2px solid #ecf0f1;
            }

            .tab {
                padding: 1rem 2rem;
                cursor: pointer;
                border-bottom: 3px solid transparent;
                transition: all 0.3s;
            }

            .tab.active {
                border-bottom-color: #3498db;
                color: #3498db;
                font-weight: 600;
            }

            .tab-content {
                display: none;
            }

            .tab-content.active {
                display: block;
            }

            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
                margin-bottom: 2rem;
            }

            .stat-card {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 1.5rem;
                border-radius: 8px;
                text-align: center;
            }

            .stat-value {
                font-size: 2rem;
                font-weight: bold;
                margin-bottom: 0.5rem;
            }

            .stat-label {
                font-size: 0.9rem;
                opacity: 0.9;
            }

            .data-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 1rem;
            }

            .data-table th,
            .data-table td {
                padding: 0.75rem;
                text-align: left;
                border-bottom: 1px solid #ecf0f1;
            }

            .data-table th {
                background: #f8f9fa;
                font-weight: 600;
                color: #555;
            }

            .status-badge {
                padding: 0.25rem 0.5rem;
                border-radius: 12px;
                font-size: 0.8rem;
                font-weight: 600;
            }

            .status-active {
                background: #d4edda;
                color: #155724;
            }

            .status-inactive {
                background: #f8d7da;
                color: #721c24;
            }

            .role-admin {
                background: #ff6b6b;
                color: white;
            }

            .role-moderator {
                background: #4ecdc4;
                color: white;
            }

            .role-user {
                background: #45b7d1;
                color: white;
            }

            .alert {
                padding: 1rem;
                border-radius: 4px;
                margin-bottom: 1rem;
            }

            .alert-success {
                background: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }

            .alert-error {
                background: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }

            .alert-info {
                background: #d1ecf1;
                color: #0c5460;
                border: 1px solid #bee5eb;
            }

            .loading {
                text-align: center;
                padding: 2rem;
                color: #666;
            }

            .status-healthy {
                border-left: 4px solid #28a745 !important;
                box-shadow: 0 2px 8px rgba(40, 167, 69, 0.2);
            }

            .status-degraded {
                border-left: 4px solid #ffc107 !important;
                box-shadow: 0 2px 8px rgba(255, 193, 7, 0.2);
            }

            .status-critical {
                border-left: 4px solid #dc3545 !important;
                box-shadow: 0 2px 8px rgba(220, 53, 69, 0.2);
            }

            #tcp-stats-grid .stat-card {
                transition: all 0.3s ease;
            }

            #tcp-stats-grid .stat-card:hover {
                transform: translateY(-2px);
            }

            .json-viewer {
                background: #2c3e50;
                color: #ecf0f1;
                padding: 1rem;
                border-radius: 4px;
                font-family: "Courier New", monospace;
                font-size: 0.9rem;
                overflow-x: auto;
                white-space: pre-wrap;
                max-height: 400px;
                overflow-y: auto;
            }

            .user-actions {
                display: flex;
                gap: 0.5rem;
            }

            .user-actions button {
                padding: 0.25rem 0.5rem;
                font-size: 0.8rem;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>üõ°Ô∏è Lair Chat Admin Dashboard</h1>
                <p>Enterprise-grade administration interface</p>
            </div>

            <!-- Authentication Section -->
            <div id="auth-section" class="auth-section">
                <h2>Admin Authentication</h2>
                <div id="auth-alert"></div>

                <form id="login-form">
                    <div class="form-group">
                        <label for="username">Username or Email:</label>
                        <input
                            type="text"
                            id="username"
                            name="username"
                            required
                            placeholder="Enter admin username"
                        />
                    </div>

                    <div class="form-group">
                        <label for="password">Password:</label>
                        <input
                            type="password"
                            id="password"
                            name="password"
                            required
                            placeholder="Enter password"
                        />
                    </div>

                    <button type="submit">Login as Admin</button>
                    <button
                        type="button"
                        id="test-connection"
                        class="secondary"
                    >
                        Test API Connection
                    </button>
                </form>

                <div id="connection-status" class="alert alert-info hidden">
                    <strong>API Status:</strong>
                    <span id="api-status">Unknown</span>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboard-section" class="dashboard-section hidden">
                <div class="user-info">
                    <h2>Welcome, <span id="admin-username">Admin</span>!</h2>
                    <p>
                        Role:
                        <span id="admin-role" class="status-badge role-admin"
                            >Admin</span
                        >
                    </p>
                    <button id="logout-btn" class="danger">Logout</button>
                </div>

                <!-- Navigation Tabs -->
                <div class="tabs">
                    <div class="tab active" data-tab="overview">
                        üìä Overview
                    </div>
                    <div class="tab" data-tab="users">üë• Users</div>
                    <div class="tab" data-tab="rooms">üè† Rooms</div>
                    <div class="tab" data-tab="system">‚öôÔ∏è System</div>
                    <div class="tab" data-tab="tools">üîß Tools</div>
                </div>

                <!-- Overview Tab -->
                <div id="tab-overview" class="tab-content active">
                    <h3>Server Statistics</h3>
                    <div id="stats-grid" class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="stat-users">-</div>
                            <div class="stat-label">Total Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="stat-online">-</div>
                            <div class="stat-label">Online Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="stat-rooms">-</div>
                            <div class="stat-label">Total Rooms</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="stat-messages">-</div>
                            <div class="stat-label">Total Messages</div>
                        </div>
                    </div>

                    <h3>TCP Server Statistics</h3>
                    <div id="tcp-stats-grid" class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="tcp-connected-peers">
                                -
                            </div>
                            <div class="stat-label">TCP Connections</div>
                        </div>
                        <div class="stat-card">
                            <div
                                class="stat-value"
                                id="tcp-authenticated-users"
                            >
                                -
                            </div>
                            <div class="stat-label">TCP Authenticated</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="tcp-active-rooms">
                                -
                            </div>
                            <div class="stat-label">TCP Active Rooms</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="tcp-pending-invites">
                                -
                            </div>
                            <div class="stat-label">Pending Invites</div>
                        </div>
                    </div>

                    <h3>System Health</h3>
                    <div id="system-health">
                        <div class="loading">Loading system health...</div>
                    </div>

                    <button id="refresh-stats" class="secondary">
                        üîÑ Refresh Stats
                    </button>
                </div>

                <!-- Users Tab -->
                <div id="tab-users" class="tab-content">
                    <h3>User Management</h3>
                    <button id="load-users">Load Users</button>
                    <div id="users-content">
                        <div class="loading">
                            Click "Load Users" to view user data
                        </div>
                    </div>
                </div>

                <!-- Rooms Tab -->
                <div id="tab-rooms" class="tab-content">
                    <h3>Room Management</h3>
                    <button id="load-rooms">Load Rooms</button>
                    <div id="rooms-content">
                        <div class="loading">
                            Click "Load Rooms" to view room data
                        </div>
                    </div>
                </div>

                <!-- System Tab -->
                <div id="tab-system" class="tab-content">
                    <h3>System Maintenance</h3>
                    <div class="form-group">
                        <button id="perform-maintenance">
                            üîß Perform Maintenance
                        </button>
                        <button id="view-audit-logs" class="secondary">
                            üìã View Audit Logs
                        </button>
                    </div>
                    <div id="system-content">
                        <div class="alert alert-info">
                            Use the buttons above to perform system maintenance
                            tasks.
                        </div>
                    </div>
                </div>

                <!-- Tools Tab -->
                <div id="tab-tools" class="tab-content">
                    <h3>Database & API Tools</h3>

                    <div class="form-group">
                        <h4>API Testing</h4>
                        <select id="api-endpoint">
                            <option value="/api/v1/admin/stats">
                                GET /admin/stats
                            </option>
                            <option value="/api/v1/admin/health">
                                GET /admin/health
                            </option>
                            <option value="/api/v1/admin/users">
                                GET /admin/users
                            </option>
                            <option value="/api/v1/admin/rooms">
                                GET /admin/rooms
                            </option>
                            <option value="/api/v1/admin/audit">
                                GET /admin/audit
                            </option>
                        </select>
                        <button id="test-endpoint">Test Endpoint</button>
                    </div>

                    <div class="form-group">
                        <h4>User Role Management</h4>
                        <input type="text" id="user-id" placeholder="User ID" />
                        <select id="new-role">
                            <option value="admin">Admin</option>
                            <option value="moderator">Moderator</option>
                            <option value="user">User</option>
                            <option value="guest">Guest</option>
                        </select>
                        <button id="update-user-role">Update Role</button>
                    </div>

                    <div id="tools-output">
                        <div class="alert alert-info">
                            Tool outputs will appear here.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // API Configuration - Auto-detect if running integrated or standalone
            const API_BASE =
                window.location.protocol +
                "//" +
                window.location.hostname +
                ":8082/api/v1";
            let authToken = null;
            let currentUser = null;
            let isIntegratedMode =
                window.location.pathname.startsWith("/admin/");

            // DOM Elements
            const authSection = document.getElementById("auth-section");
            const dashboardSection =
                document.getElementById("dashboard-section");
            const loginForm = document.getElementById("login-form");
            const authAlert = document.getElementById("auth-alert");
            const connectionStatus =
                document.getElementById("connection-status");
            const apiStatus = document.getElementById("api-status");

            // Initialize
            document.addEventListener("DOMContentLoaded", function () {
                setupEventListeners();
                testConnection();
            });

            function setupEventListeners() {
                // Authentication
                loginForm.addEventListener("submit", handleLogin);
                document
                    .getElementById("test-connection")
                    .addEventListener("click", testConnection);
                document
                    .getElementById("logout-btn")
                    .addEventListener("click", handleLogout);

                // Tab navigation
                document.querySelectorAll(".tab").forEach((tab) => {
                    tab.addEventListener("click", function () {
                        switchTab(this.dataset.tab);
                    });
                });

                // Dashboard actions
                document
                    .getElementById("refresh-stats")
                    .addEventListener("click", loadServerStats);
                document
                    .getElementById("load-users")
                    .addEventListener("click", loadUsers);
                document
                    .getElementById("load-rooms")
                    .addEventListener("click", loadRooms);
                document
                    .getElementById("perform-maintenance")
                    .addEventListener("click", performMaintenance);
                document
                    .getElementById("view-audit-logs")
                    .addEventListener("click", viewAuditLogs);

                // Tools
                document
                    .getElementById("test-endpoint")
                    .addEventListener("click", testEndpoint);
                document
                    .getElementById("update-user-role")
                    .addEventListener("click", updateUserRole);
            }

            async function testConnection() {
                try {
                    const response = await fetch(`${API_BASE}/health`);
                    if (response.ok) {
                        apiStatus.textContent = "Connected ‚úÖ";
                        connectionStatus.className = "alert alert-success";
                    } else {
                        apiStatus.textContent = "API Error ‚ùå";
                        connectionStatus.className = "alert alert-error";
                    }
                } catch (error) {
                    apiStatus.textContent = "Connection Failed ‚ùå";
                    connectionStatus.className = "alert alert-error";
                }
                connectionStatus.classList.remove("hidden");
            }

            async function handleLogin(e) {
                e.preventDefault();

                const username = document.getElementById("username").value;
                const password = document.getElementById("password").value;

                try {
                    const response = await fetch(`${API_BASE}/auth/login`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            identifier: username,
                            password: password,
                            remember_me: true,
                        }),
                    });

                    const data = await response.json();

                    if (response.ok) {
                        authToken = data.access_token;
                        currentUser = data.user;

                        // Check if user is admin
                        if (currentUser.role === "admin") {
                            showSuccess("Login successful! Welcome, admin.");
                            showDashboard();
                        } else {
                            showError(
                                "Access denied. Admin privileges required.",
                            );
                            authToken = null;
                            currentUser = null;
                        }
                    } else {
                        showError(data.message || "Login failed");
                    }
                } catch (error) {
                    showError("Connection error: " + error.message);
                }
            }

            function handleLogout() {
                authToken = null;
                currentUser = null;
                authSection.classList.remove("hidden");
                dashboardSection.classList.add("hidden");
                showInfo("Logged out successfully");
            }

            function showDashboard() {
                authSection.classList.add("hidden");
                dashboardSection.classList.remove("hidden");

                // Update user info
                document.getElementById("admin-username").textContent =
                    currentUser.username;
                document.getElementById("admin-role").textContent =
                    currentUser.role.toUpperCase();

                // Load initial data
                loadServerStats();
            }

            async function loadServerStats() {
                try {
                    const response = await apiRequest("/admin/stats");
                    if (response.ok) {
                        const data = await response.json();
                        const stats = data.data;

                        document.getElementById("stat-users").textContent =
                            stats.total_users || "-";
                        document.getElementById("stat-online").textContent =
                            stats.online_users || "-";
                        document.getElementById("stat-rooms").textContent =
                            stats.total_rooms || "-";
                        document.getElementById("stat-messages").textContent =
                            stats.total_messages || "-";
                    } else {
                        showError("Failed to load server statistics");
                    }
                } catch (error) {
                    showError("Error loading stats: " + error.message);
                }

                // Load system health and extract TCP server information
                try {
                    const response = await apiRequest("/admin/health");
                    if (response.ok) {
                        const data = await response.json();
                        displaySystemHealth(data.data);
                        displayTcpServerStats(data.data);
                    }
                } catch (error) {
                    document.getElementById("system-health").innerHTML =
                        '<div class="alert alert-error">Failed to load system health</div>';
                    // Reset TCP stats display
                    document.getElementById("tcp-connected-peers").textContent =
                        "-";
                    document.getElementById(
                        "tcp-authenticated-users",
                    ).textContent = "-";
                    document.getElementById("tcp-active-rooms").textContent =
                        "-";
                    document.getElementById("tcp-pending-invites").textContent =
                        "-";
                }
            }

            function displaySystemHealth(health) {
                const healthDiv = document.getElementById("system-health");
                healthDiv.innerHTML = `
                <div class="json-viewer">${JSON.stringify(health, null, 2)}</div>
            `;
            }

            function displayTcpServerStats(health) {
                // Find the TCP Server component in the health data
                const tcpComponent = health.components.find(
                    (component) => component.name === "TCP Server",
                );

                if (tcpComponent && tcpComponent.metadata) {
                    const metadata = tcpComponent.metadata;

                    // Update TCP server statistics
                    document.getElementById("tcp-connected-peers").textContent =
                        metadata.connected_peers || "-";
                    document.getElementById(
                        "tcp-authenticated-users",
                    ).textContent = metadata.authenticated_users || "-";
                    document.getElementById("tcp-active-rooms").textContent =
                        metadata.active_rooms || "-";
                    document.getElementById("tcp-pending-invites").textContent =
                        metadata.pending_invitations || "-";

                    // Update TCP server status indicator
                    const tcpStatus = tcpComponent.status;
                    const tcpCards = document.querySelectorAll(
                        "#tcp-stats-grid .stat-card",
                    );
                    tcpCards.forEach((card) => {
                        card.classList.remove(
                            "status-healthy",
                            "status-degraded",
                            "status-critical",
                        );
                        if (tcpStatus === "Healthy") {
                            card.classList.add("status-healthy");
                        } else if (tcpStatus === "Degraded") {
                            card.classList.add("status-degraded");
                        } else if (tcpStatus === "Critical") {
                            card.classList.add("status-critical");
                        }
                    });
                } else {
                    // TCP server not available or no data
                    document.getElementById("tcp-connected-peers").textContent =
                        "N/A";
                    document.getElementById(
                        "tcp-authenticated-users",
                    ).textContent = "N/A";
                    document.getElementById("tcp-active-rooms").textContent =
                        "N/A";
                    document.getElementById("tcp-pending-invites").textContent =
                        "N/A";
                }
            }

            async function loadUsers() {
                const usersContent = document.getElementById("users-content");
                usersContent.innerHTML =
                    '<div class="loading">Loading users...</div>';

                try {
                    const response = await apiRequest("/admin/users");
                    if (response.ok) {
                        const data = await response.json();
                        displayUsers(data.data || []);
                    } else {
                        usersContent.innerHTML =
                            '<div class="alert alert-error">Failed to load users</div>';
                    }
                } catch (error) {
                    usersContent.innerHTML =
                        '<div class="alert alert-error">Error: ' +
                        error.message +
                        "</div>";
                }
            }

            function displayUsers(users) {
                const usersContent = document.getElementById("users-content");

                if (users.length === 0) {
                    usersContent.innerHTML =
                        '<div class="alert alert-info">No users found</div>';
                    return;
                }

                let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

                users.forEach((user) => {
                    html += `
                    <tr>
                        <td>${user.username}</td>
                        <td>${user.email || "N/A"}</td>
                        <td><span class="status-badge role-${user.role}">${user.role.toUpperCase()}</span></td>
                        <td><span class="status-badge ${user.status === "active" ? "status-active" : "status-inactive"}">${user.status}</span></td>
                        <td>${new Date(user.created_at).toLocaleDateString()}</td>
                        <td class="user-actions">
                            <button class="secondary" onclick="viewUser('${user.id}')">View</button>
                            <button onclick="editUser('${user.id}')">Edit</button>
                        </td>
                    </tr>
                `;
                });

                html += "</tbody></table>";
                usersContent.innerHTML = html;
            }

            async function loadRooms() {
                const roomsContent = document.getElementById("rooms-content");
                roomsContent.innerHTML =
                    '<div class="loading">Loading rooms...</div>';

                try {
                    const response = await apiRequest("/admin/rooms");
                    if (response.ok) {
                        const data = await response.json();
                        displayRooms(data.data || []);
                    } else {
                        roomsContent.innerHTML =
                            '<div class="alert alert-error">Failed to load rooms</div>';
                    }
                } catch (error) {
                    roomsContent.innerHTML =
                        '<div class="alert alert-error">Error: ' +
                        error.message +
                        "</div>";
                }
            }

            function displayRooms(rooms) {
                const roomsContent = document.getElementById("rooms-content");
                const html = `<div class="json-viewer">${JSON.stringify(rooms, null, 2)}</div>`;
                roomsContent.innerHTML = html;
            }

            async function performMaintenance() {
                const systemContent = document.getElementById("system-content");
                systemContent.innerHTML =
                    '<div class="loading">Performing maintenance...</div>';

                try {
                    const response = await apiRequest(
                        "/admin/maintenance",
                        "POST",
                    );
                    if (response.ok) {
                        systemContent.innerHTML =
                            '<div class="alert alert-success">Maintenance completed successfully</div>';
                    } else {
                        systemContent.innerHTML =
                            '<div class="alert alert-error">Maintenance failed</div>';
                    }
                } catch (error) {
                    systemContent.innerHTML =
                        '<div class="alert alert-error">Error: ' +
                        error.message +
                        "</div>";
                }
            }

            async function viewAuditLogs() {
                const systemContent = document.getElementById("system-content");
                systemContent.innerHTML =
                    '<div class="loading">Loading audit logs...</div>';

                try {
                    const response = await apiRequest("/admin/audit");
                    if (response.ok) {
                        const data = await response.json();
                        systemContent.innerHTML = `<div class="json-viewer">${JSON.stringify(data, null, 2)}</div>`;
                    } else {
                        systemContent.innerHTML =
                            '<div class="alert alert-error">Failed to load audit logs</div>';
                    }
                } catch (error) {
                    systemContent.innerHTML =
                        '<div class="alert alert-error">Error: ' +
                        error.message +
                        "</div>";
                }
            }

            async function testEndpoint() {
                const endpoint = document.getElementById("api-endpoint").value;
                const output = document.getElementById("tools-output");

                output.innerHTML =
                    '<div class="loading">Testing endpoint...</div>';

                try {
                    const response = await apiRequest(endpoint);
                    const data = await response.json();

                    output.innerHTML = `
                    <h4>Response (${response.status})</h4>
                    <div class="json-viewer">${JSON.stringify(data, null, 2)}</div>
                `;
                } catch (error) {
                    output.innerHTML =
                        '<div class="alert alert-error">Error: ' +
                        error.message +
                        "</div>";
                }
            }

            async function updateUserRole() {
                const userId = document.getElementById("user-id").value;
                const newRole = document.getElementById("new-role").value;
                const output = document.getElementById("tools-output");

                if (!userId) {
                    output.innerHTML =
                        '<div class="alert alert-error">Please enter a user ID</div>';
                    return;
                }

                output.innerHTML =
                    '<div class="loading">Updating user role...</div>';

                try {
                    const response = await apiRequest(
                        `/admin/users/${userId}/role`,
                        "PUT",
                        {
                            role: newRole,
                        },
                    );

                    if (response.ok) {
                        output.innerHTML =
                            '<div class="alert alert-success">User role updated successfully</div>';
                    } else {
                        const error = await response.json();
                        output.innerHTML =
                            '<div class="alert alert-error">Error: ' +
                            (error.message || "Unknown error") +
                            "</div>";
                    }
                } catch (error) {
                    output.innerHTML =
                        '<div class="alert alert-error">Error: ' +
                        error.message +
                        "</div>";
                }
            }

            function switchTab(tabName) {
                // Update tab buttons
                document.querySelectorAll(".tab").forEach((tab) => {
                    tab.classList.remove("active");
                });
                document
                    .querySelector(`[data-tab="${tabName}"]`)
                    .classList.add("active");

                // Update tab content
                document.querySelectorAll(".tab-content").forEach((content) => {
                    content.classList.remove("active");
                });
                document
                    .getElementById(`tab-${tabName}`)
                    .classList.add("active");
            }

            async function apiRequest(endpoint, method = "GET", body = null) {
                const options = {
                    method,
                    headers: {
                        "Content-Type": "application/json",
                    },
                };

                if (authToken) {
                    options.headers["Authorization"] = `Bearer ${authToken}`;
                }

                if (body) {
                    options.body = JSON.stringify(body);
                }

                return fetch(`${API_BASE}${endpoint}`, options);
            }

            function showSuccess(message) {
                authAlert.innerHTML = `<div class="alert alert-success">${message}</div>`;
            }

            function showError(message) {
                authAlert.innerHTML = `<div class="alert alert-error">${message}</div>`;
            }

            function showInfo(message) {
                authAlert.innerHTML = `<div class="alert alert-info">${message}</div>`;
            }

            // Global functions for user actions
            window.viewUser = function (userId) {
                alert("View user: " + userId);
            };

            window.editUser = function (userId) {
                alert("Edit user: " + userId);
            };
        </script>
    </body>
</html>
